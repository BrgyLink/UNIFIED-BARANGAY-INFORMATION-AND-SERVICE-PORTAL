@page
@model BrgyLink.Pages.ManageBarangayOfficials.CreateModel

@{
    ViewData["Title"] = "Create Barangay Official";
    Layout = "~/Pages/Shared/_AdminLayout.cshtml";
}

<!-- Table Title -->
<div class="mb-4">
    <div class="card shadow-sm border-0">
        <div class="card-body d-flex justify-content-between align-items-center">
            <!-- Section Title -->
            <div>
                <h3 class="card-title mb-0">Adding New <b>Barangay Official</b></h3>
                <p class="text-muted mb-0">Make sure you check before you add.</p>
            </div>
        </div>
    </div>
</div>

<form method="post" enctype="multipart/form-data" id="createBarangayOfficialForm">
    <div asp-validation-summary="All" class="text-danger mb-4"></div>
    <div class="row">
        <!-- Image Upload Card -->
        <div class="mx grid-margin stretch-card">
            <div class="card">
                <div class="card-body text-center">
                    <h4 class="card-title">Image Upload</h4>
                    <img id="imagePreview" src="/images/avatarPlaceholder.jpg" alt="Barangay Official Image Preview" class="img-fluid rounded-circle mb-3" style="width: 250px; height: 250px; object-fit: cover;" />
                    <div>
                        <input type="file" class="form-control form-control-sm" asp-for="BarangayOfficial.ImageFile" accept=".jpg,.jpeg,.png" onchange="previewImage(this)" />
                        <small class="text-muted">Max: 5MB (JPG, JPEG, PNG)</small>
                        <span asp-validation-for="BarangayOfficial.ImageFile" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Name Section Card -->
        <div class="col-md-8 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Personal Information</h4>
                    <p class="card-description">Enter the barangay official's name details</p>
                    <div class="form-group position-relative">
                        <label for="FirstName">First Name</label>
                        <i class="mdi mdi-account-circle position-absolute" style="top: 36px; left: 10px;"></i>
                        <input type="text" class="form-control ps-5" asp-for="BarangayOfficial.FirstName" placeholder="First Name" required />
                        <span asp-validation-for="BarangayOfficial.FirstName" class="text-danger"></span>
                    </div>
                    <div class="form-group position-relative">
                        <label for="LastName">Last Name</label>
                        <i class="mdi mdi-account-circle position-absolute" style="top: 36px; left: 10px;"></i>
                        <input type="text" class="form-control ps-5" asp-for="BarangayOfficial.LastName" placeholder="Last Name" required />
                        <span asp-validation-for="BarangayOfficial.LastName" class="text-danger"></span>
                    </div>
                    <div class="form-group position-relative">
                        <label for="MiddleName">Middle Name</label>
                        <i class="mdi mdi-account-circle position-absolute" style="top: 36px; left: 10px;"></i>
                        <input type="text" class="form-control ps-5" asp-for="BarangayOfficial.MiddleName" placeholder="Middle Name" />
                        <span asp-validation-for="BarangayOfficial.MiddleName" class="text-danger"></span>
                        <small class="text-muted">If no middle name, put "None"</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Personal Information Card -->
        <div class="col-md-4 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Personal Details</h4>
                    <p class="card-description">Provide personal details</p>
                    <div class="form-group position-relative">
                        <label for="Birthdate">Birthdate</label>
                        <i class="mdi mdi-calendar position-absolute" style="top: 36px; left: 10px;"></i>
                        <input type="date" class="form-control ps-5" asp-for="BarangayOfficial.Birthdate" required />
                        <span asp-validation-for="BarangayOfficial.Birthdate" class="text-danger"></span>
                    </div>
                    <div class="form-group position-relative">
                        <label for="Gender">Gender</label>
                        <i class="mdi mdi-gender-male-female position-absolute" style="top: 36px; left: 10px;"></i>
                        <select class="form-control ps-5" asp-for="BarangayOfficial.Gender" required>
                            <option value="">Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                        <span asp-validation-for="BarangayOfficial.Gender" class="text-danger"></span>
                    </div>
                    <div class="form-group position-relative">
                        <label for="MaritalStatus">Marital Status</label>
                        <i class="mdi mdi-ring position-absolute" style="top: 36px; left: 10px;"></i>
                        <select class="form-control ps-5" asp-for="BarangayOfficial.MaritalStatus" required>
                            <option value="Single">Single</option>
                            <option value="Married">Married</option>
                            <option value="Divorced">Divorced</option>
                            <option value="Widowed">Widowed</option>
                        </select>
                        <span asp-validation-for="BarangayOfficial.MaritalStatus" class="text-danger"></span>
                    </div>
                    <div class="form-group position-relative">
                        <label for="BarangayPosition">Barangay Position</label>
                        <i class="mdi mdi-briefcase position-absolute" style="top: 36px; left: 10px;"></i>
                        <input type="text" class="form-control ps-5" asp-for="BarangayOfficial.BarangayPosition" placeholder="Barangay Position" required />
                        <span asp-validation-for="BarangayOfficial.BarangayPosition" class="text-danger"></span>
                    </div>
                    <div class="form-group position-relative">
                        <label for="TermStart">Term Start</label>
                        <i class="mdi mdi-calendar position-absolute" style="top: 36px; left: 10px;"></i>
                        <input type="date" class="form-control ps-5" asp-for="BarangayOfficial.TermStart" required />
                        <span asp-validation-for="BarangayOfficial.TermStart" class="text-danger"></span>
                    </div>
                    <div class="form-group position-relative">
                        <label for="TermEnd">Term End</label>
                        <i class="mdi mdi-calendar position-absolute" style="top: 36px; left: 10px;"></i>
                        <input type="date" class="form-control ps-5" asp-for="BarangayOfficial.TermEnd" required />
                        <span asp-validation-for="BarangayOfficial.TermEnd" class="text-danger"></span>
                    </div>
                    <div class="form-group position-relative">
                        <label for="Status">Status</label>
                        <i class="mdi mdi-account-check position-absolute" style="top: 36px; left: 10px;"></i>
                        <select class="form-control ps-5" asp-for="BarangayOfficial.Status" required>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                        <span asp-validation-for="BarangayOfficial.Status" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Committees Card -->
        <div class="col-md-8 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Committees</h4>
                    <p class="card-description">Select committees the barangay official is part of</p>
                    <div class="form-group">
                        @foreach (var committee in Model.Committees)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" asp-for="SelectedCommitteeIds" value="@committee.CommitteeId" />
                                <label class="form-check-label" for="SelectedCommitteeIds">@committee.CommitteeName</label>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="mx d-flex justify-content-between">
            <a asp-page="/ManageBarangayOfficials/Index" class="btn btn-danger">
                Back
            </a>
            <button type="submit" class="btn btn-primary">Save Barangay Official</button>
        </div>
    </div>
</form>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size cannot exceed 5MB');
                    input.value = '';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('imagePreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        @if (TempData["SuccessMessage"] != null)
        {
            <text>
                    $(document).ready(function () {
                        Swal.fire({
                            title: 'Success',
                            text: '@TempData["SuccessMessage"]',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.href = '/ManageBarangayOfficials/Index';
                            }
                        });
                    });
            </text>
        }
    </script>
}
